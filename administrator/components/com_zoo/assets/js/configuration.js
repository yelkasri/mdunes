/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function(t){var a=function(){};a.prototype=t.extend(a.prototype,{name:"ApplicationEdit",options:{url:"index.php?option=com_zoo&controller=configuration",config_url:"index.php?option=com_config&task=config.store&format=raw",application_id:0,application_group:""},initialize:function(a,o){this.options=t.extend({},this.options,o);var i=this,e=t("#parameter-accordion"),n=t("#template"),s=t("#zoo-permissions");n.bind("change",function(){var a=t('<span class="loader">').insertAfter(n);e.fadeOut(),t.ajax({url:i.options.url,data:{task:"getApplicationParams",format:"raw","cid[]":i.options.application_id,group:i.options.application_group,template:t(this).val()},success:function(t){e.html(t).fadeIn().accordionMenu({mode:"slide",display:0}),a.remove()}})}),s.find("select").change(function(){i.sendPermissions(this)})},sendPermissions:function(a){var o=t(a),i=t(document.getElementById("icon_"+o.attr("id"))),e="com_zoo.application."+this.options.application_id,n=t("input[name=alias]").val(),s=o.val(),r=o.attr("id").split("_"),l="application"!==r[1]?r[1]:!1,p="GET",c=t("#zoo-permissions [data-ajaxuri]:first");l!==!1&&(e+="."+l,n+=" ("+l+")"),i.attr("class",""),i.attr("style","background: url(../media/system/images/modal/spinner.gif); display: inline-block; width: 16px; height: 16px"),c.length&&(p="POST",this.options.config_url=c.data("ajaxuri")),t.ajax({method:p,url:this.options.config_url,datatype:"json",data:{comp:e,action:r[2],rule:r[3],value:s,title:n}}).fail(function(t,a,o){i.attr("style",""),Joomla.renderMessages(Joomla.ajaxErrorsMessages(t,a,o)),window.scrollTo(0,0),i.attr("class","icon-cancel")}).done(function(t){i.attr("style",""),t.data&&1==t.data.result&&(i.attr("class","icon-save"),o.parents().next("td").find("span").attr("class",t.data["class"]).html(t.data.text)),"object"==typeof t.messages&&null!==t.messages&&(Joomla.renderMessages(t.messages),t.data&&1==t.data.result?i.attr("class","icon-save"):i.attr("class","icon-cancel"),window.scrollTo(0,0))})}}),t.fn[a.prototype.name]=function(){var o=arguments,i=o[0]?o[0]:null;return this.each(function(){var e=t(this);if(a.prototype[i]&&e.data(a.prototype.name)&&"initialize"!=i)e.data(a.prototype.name)[i].apply(e.data(a.prototype.name),Array.prototype.slice.call(o,1));else if(!i||t.isPlainObject(i)){var n=new a;a.prototype.initialize&&n.initialize.apply(n,t.merge([e],o)),e.data(a.prototype.name,n)}else t.error("Method "+i+" does not exist on jQuery."+a.name)})}}(jQuery);