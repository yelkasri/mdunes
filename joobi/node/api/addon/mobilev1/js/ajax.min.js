function jCountW(a,b){if(b=="true"){if(a=="try"){jCountW.countTry=0}else{if(a=="cnt"){jCountW.countCnt=0}else{jCountW.count=0}}return true}if(a=="try"){jCountW.countTry=++jCountW.countTry||1;return jCountW.countTry}else{if(a=="cnt"){jCountW.countCnt=++jCountW.countCnt||1;return jCountW.countCnt}else{jCountW.count=++jCountW.count||1;return jCountW.count}}}function jAjaxW(){var a=this;this.ajaxTimeout=30000;this.countdownfrom=10;this.maxretry=20;this.progressText="";this.joobiSaveLastMessage="";this.jQueryFlag=true;this.checkNwFlag=true;this.checkURLnw="https://www.google.com";this.nwTimeout=15000;this.run=function(b,c,d){ct=jCountW();if(ct<=1){jQuery("#WAjxStatus").html(jCore.msg.prgr);jQuery("#WAjxDuration").html(jCore.msg.cal);if(typeof(jCore.msg.frstmsg)!="undefined"&&jCore.msg.frstmsg!=""){jQuery("#WAjxRefresh").html(jCore.msg.frstmsg)}if(c.controller){b=b+"&controller="+c.controller}if(c.task){b=b+"&task="+c.task}}if(typeof(jCore.msg.maxTime)!="undefined"&&jCore.msg.maxTime>15){this.ajaxTimeout=jCore.msg.maxTime*1000+30000}this.sendProcessRequest(b,c,d);return true};this.sendProcessRequest=function(b,c,d){jQuery.ajax({url:b,type:"POST",timeout:this.ajaxTimeout,cache:false,data:jQuery(d).serialize(),success:function(e,i,h){myAr=JSON.parse(e);var g=myAr.length;var f="";for(index=0;index<g;++index){obj=myAr[index];div=obj.id;if(div[0]!="#"){div="#"+div}switch(obj.action){case"replace":jQuery(div).replaceWith(obj.text);break;case"append":jQuery(div).append(obj.text);break;case"html":default:jQuery(div).html(obj.text);break}if(obj.status=="failed"||obj.status=="complete"){f=obj.status}}if(f=="failed"){}else{if(f!="complete"){joobiAjax.run(b,c,d)}else{if(typeof(jCore.msg.sound)!="undefined"&&jCore.msg.sound!=""){jQuery("#WAjxAppend").append(jCore.msg.sound);if(typeof(jCore.msg.url)!="undefined"&&jCore.msg.url!=""){window.location=jCore.msg.url}}}}},error:function(e,g,f){if(a.checkNwFlag){jQuery("#WAjxPaneWarning").css("display","block");jQuery("#WAjxWarning").html(jCore.msg.chkit);a.checkNetwork(a.checkURLnw,a.nwTimeout);a.nwTimeout=a.nwTimeout*2;joobiAjax.run(b,c,d);return true}if(g=="timeout"){ty=jCountW("try");a.inform(ty,b,c)}else{jQuery("#WAjxPaneError").css("display","block");jQuery("#WAjxError").append("<br><br>The Server responded with an error<br>");jQuery("#WAjxError").append("Status is : "+g+" <br>");jQuery("#WAjxError").append("Error Thrown is : "+f+" <br>");jQuery("#WAjxError").append("URL : "+b+" <br>");jQuery("#WAjxError").append("Response text plain : "+e.responseText+" <br>")}}})};this.inform=function(d,b,c){tm=a.countdownfrom-d;jQuery("#WAjxError").html(jCore.msg.stop);jQuery("#WAjxPaneError").css("display","block");jQuery("#WAjxErrorTime").html(tm);if((tm==0)){cnt=jCountW("cnt");jCountW("try","true");if(cnt>a.maxretry){jQuery("#WAjxError").html(jCore.msg.exhaust);jQuery("#WAjxPaneError").css("display","block");return}else{a.ajaxTimeout=a.ajaxTimeout+(a.countdownfrom*1000);a.countdownfrom=a.countdownfrom*2;jQuery("#WAjxPaneError").css("display","none");jQuery("#WAjxPaneWarning").css("display","none");a.sendProcessRequest(b,c)}}else{setTimeout(function(){ty=jCountW("try");a.inform(ty,b,c)},1000)}};this.checkNetwork=function(d,c){r=Math.round(Math.random()*10000);var b="templates/system/images/calendar.png?rand="+r;jQuery.ajax({url:b,method:"GET",success:function(e){jQuery("#WAjxPaneWarning").css("display","block");jQuery("#WAjxWarning").append("<br>"+jCore.msg.chkscs);a.checkNwFlag=false},error:function(g,e,f){jQuery("#WAjxPaneError").css("display","block");jQuery("#WAjxError").html(jCore.msg.chkerr);a.checkNwFlag=true}})}}var joobiAjax=new jAjaxW();