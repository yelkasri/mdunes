var joobiSaveLastMessage="";var jQueryFlag=true;var checkNwFlag=true;var ajaxTimeout=30000;var countdownfrom=10;var onesecond=1000;var retryAttempt=1;var maxretry=10;var checkURLnw="http://google.com";var nwTimeout=15000;function jextreinstall(c,a,b){jextinstup(c,a,b)}function jextinstup(g,e,f){if(typeof(f)=="object"){f=jQuery(f).serialize()}var h="";if(g.match("BIGMSG")){h=messageMatch(g,"BIGMSG","any")}if(g.match("SETUPPAGE")){url=messageMatch(g,"SETUPPAGE","any");window.location=url;return true}if(h==""){h=g}if(joobiSaveLastMessage==h){erorMsg='<br/>Error: Received twice the same message from the install. The install was stopped. Click on this link to try to <a href="index.php?option=com_jcenter&amp;controller=install&amp;task=clean">Reset</a> the installation.<br/>If problem persist, please contact the support with this message and the logs of the install <br>in the folder your_website/joobi/user/logs <br>If there is no logs it means the folder permission is not set properly.<br>ServerResponse:'+h;return WAjaxResp(erorMsg,"#joobi_status_install","append")}joobiSaveLastMessage=h;if(g.match("FINERROR")){h='<blink><font color="red"><b>'+h+"</b></font></blink>";document.getElementById("jloader_status").style.display="none";WAjaxResp(h,"#joobi_status_install")}else{if(g.match("Fatal error")){return WAjaxResp("A fatal error occured during the install process. Contact the support with the message below:<br/>"+g,"#joobi_status_install")}}if(g.match("FINISH")){h='<blink><font color="green"><b>'+h+"</b></font></blink>";document.getElementById("joobi_status_install").style.display="none";WAjaxResp(h,"#joobi_status_install");var d=document.getElementById("alex_redirect_link");if(d!==null){window.location=d.href}else{document.getElementById("jloader_status").style.display="none";document.getElementById("joobi_status_install").style.display="block"}return}if(g.match("STATUS")){var a=messageMatch(g,"STATUS","number")}if(g.match("SMALLMSG")){var c=messageMatch(g,"SMALLMSG","any")}switch(a){case 0:case 1:case 2:if(g.match("JERROR")){var b=messageMatch(g,"JERROR","number");jwriteResponse(c,"status_"+b,jCore.ajxprms.extfct+" jberror")}if(g.match("JSUCCESS")){var b=messageMatch(g,"JSUCCESS","number");jwriteResponse(c,"status_"+b,jCore.ajxprms.extfct+" jbsuccess")}break}WAjaxResp(h,"#joobi_status_install");if(g.match("ADDYESNO")){WAjaxResp(h+"<br/>","#joobi_status_install");joobiAddButton("joobi_status_install","Yes",continueInstall,e,f);joobiAddButton("joobi_status_install","Cancel",stopInstall,e,f)}else{if(!g.match("JEXIT")){document.getElementById("jloader_status").style.display="block";sendProcessRequest(e,f)}}}function handleFailure(a,b,d){if(a.status==500||a.status==403){var c="<br/>The processing has been interrupted by the hosting ( Error "+a.status+" ). The processing will be paused for 30 seconds before continuing";WAjaxResp(c,"#joobi_status_install","append");joobiSaveLastMessage=c;setTimeout('sendProcessRequest("'+b+'","'+d+'");',30000)}else{if(a.status==0){joobiSaveLastMessage="Received a response from the server without any status code";jextinstup("BIGMSG["+joobiSaveLastMessage+"]",b,d)}else{if(joobiSaveLastMessage=="ERROR OF CONNECTION"){alert("[AJAX] J30 A problem occurred during the request. Status is "+a.status+". Could not connect to the url:"+b)}else{joobiSaveLastMessage="ERROR OF CONNECTION";jextinstup("BIGMSG["+joobiSaveLastMessage+"]",b,d)}}}}function sendProcessRequest(url,form){if(checkNwFlag){errMsg='<pre><code class="prettyprint"> Checking for Internet Connectivity </code></pre>';WAjaxResp(errMsg,"#joobi_status_install");checkNwFlag=false;setTimeout(function(){checkNetwork()},nwTimeout)}jQuery.ajax({url:url,type:"POST",timeout:ajaxTimeout,cache:false,data:form,success:function(jqXHR,textStatus,errorThrown){jextinstup(jqXHR,url,form)},error:function(jqXHR,textStatus,errorThrown){if(textStatus=="timeout"){inform(countdownfrom,url,form)}else{var err=eval("("+jqXHR.responseText+")");errMsg='<pre><code class="prettyprint">Error Response From The Server. <br> Staus is - '+textStatus+" <br> Error Thrown is - "+errorThrown+" <br> URL - "+url+" <br> response text plain - "+jqXHR.responseText+" <br> response text eval - "+err+" </code></pre>";WAjaxResp(errMsg,"#joobi_status_install")}}})}function inform(h,a,b){var g=new Date();var j=h-1;var c=new Date();c.setHours(0);c.setMinutes(0);c.setSeconds(j);var e=new Date(c.valueOf()-onesecond);var i=e.toTimeString().split(" ");var f=i[0].split(":");countdownMsg='<pre><code class="prettyprint"> Installation Stopped Temporarily. <br/>  Either your server is slow to respond or the internet connection was lost  <br> Retrying in '+f[2]+"  seconds</code></pre>";WAjaxResp(countdownMsg,"#joobi_status_install");if((f[2]==="00")){retryAttempt++;if(retryAttempt>maxretry){manualMsg='<pre><code class="prettyprint"> Execution stopped completely as the retry attempts were exhausted.<br> Please try an offline install or contact Joobi support</code></pre>';WAjaxResp(manualMsg,"#joobi_status_install");return}else{ajaxTimeout=retryAttempt*10*onesecond+ajaxTimeout;sendProcessRequest(a,b)}}else{setTimeout(function(){inform(j,a,b)},onesecond)}}function messageMatch(c,a,b){switch(b){case"any":b="(?:(?!\\]).)*";break;case"number":b="[0-9]+";break}c=c.replace(/([^>])\n/g,"$1<br />");regex=new RegExp(a+"\\[("+b+")\\]");Args=c.match(regex);if(Args){return Args[1]}return""}function joobiAddButton(g,a,f,c,e){var b=document.createElement("input");b.type="submit";b.value=a;b.name=a;b.id=a;b.className="bouton";mydiv=document.getElementById(g);if(mydiv){mydiv.appendChild(b);var d=document.getElementById(a);if(d){jQuery("#"+d).on("click",function(i){var h=new Event(i);h.stop();f(e,c)})}}}function continueInstall(b,a){normalInstall(b,a,1)}function stopInstall(b,a){normalInstall(b,a,0)}function normalInstall(c,b,a){document.getElementById("jloader_status").style.display="block";jQuery.ajax({url:b,data:c+"&continue_status="+a,method:"POST",success:function(d){jextinstup(d,b,c)}})}function checkNetwork(){jQuery.ajax({url:checkURLnw,type:"POST",timeout:nwTimeout,data:"cn=checknetwork",success:function(a,c,b){manualMsg='<pre><code class="prettyprint">Internet Connection Check was a success </code></pre>';WAjaxResp(manualMsg,"#joobi_status_install")},error:function(a,c,b){manualMsg='<pre><code class="prettyprint">Oops...  looks like we have a network error ! <br>Please check your internet/server connection </code></pre>';WAjaxResp(manualMsg,"#joobi_status_install")}})};